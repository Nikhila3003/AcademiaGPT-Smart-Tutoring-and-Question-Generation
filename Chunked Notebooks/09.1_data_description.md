page_content='[Instacart](https://www.instacart.com/) is an online grocery retailer that sells and deliver grocery products. The data that we will use today comes from the an open sourced subset of 3 million Instacart orders and contains data on what was ordered and which customer ordered it.  \n```python\nimport pandas as pd\n```' metadata={'Header 1': 'Data Description: Instacart Dataset'}page_content="The dataset was released as a part of a Kaggle competition. Instacart described the dataset in the competition description by saying,  \n> The dataset for this competition is a relational set of files describing customers' orders over time. The goal of the competition is to predict which products will be in a user's next order. The dataset is anonymized and contains a sample of over 3 million grocery orders from more than 200,000 Instacart users. For each user, we provide between 4 and 100 of their orders, with the sequence of products purchased in each order. We also provide the week and hour of day the order was placed, and a relative measure of time between orders. For more information, see the blog post accompanying its [public release](https://tech.instacart.com/3-million-instacart-orders-open-sourced-d40d29ead6f2).  \n“The Instacart Online Grocery Shopping Dataset 2017”, Accessed from https://www.kaggle.com/c/instacart-market-basket-analysis/data on 2020-12-27" metadata={'Header 1': 'Data Description: Instacart Dataset', 'Header 2': 'Data files'}page_content='This file contains metadata about the aisles:  \n* `aisle_id`: The aisle identifier\n* `aisle`: A string name describing the aisle  \n```python\naisle = pd.read_csv("https://compsosci-resources.s3.amazonaws.com/instacart/aisles.csv")\naisle.to_parquet("aisles.parquet")  \n```  \n```python\naisle.tail()\n```' metadata={'Header 1': 'Data Description: Instacart Dataset', 'Header 2': 'Data files', 'Header 3': 'Aisles: `aisles.csv`'}page_content='This file contains metadata about the departments:  \n* `department_id`: The department identifier\n* `department`: A string name describing the department  \n```python\ndepartment = pd.read_csv("https://compsosci-resources.s3.amazonaws.com/instacart/departments.csv")\ndepartment.to_parquet("departments.parquet")\n```  \n```python\ndepartment.tail()\n```' metadata={'Header 1': 'Data Description: Instacart Dataset', 'Header 2': 'Data files', 'Header 3': 'Departments: `department.csv`'}page_content='This file contains metadata about each of the products:  \n* `product_id`: An identifier for the product that was purchased\n* `product_name`: A string name for the product\'s description\n* `aisle_id`: The aisle identifier for the "aisle" that the item is from\n* `department_id`: The department identifier for the department that the item is from  \n```python\nproducts = pd.read_csv("https://compsosci-resources.s3.amazonaws.com/instacart/products.csv")\nproducts.to_parquet("products.parquet")\n```  \n```python\nproducts.head()\n```  \n```python' metadata={'Header 1': 'Data Description: Instacart Dataset', 'Header 2': 'Data files', 'Header 3': 'Products: `products.csv`'}page_content='products.groupby(\n["aisle_id", "department_id"]\n)["product_name"].count().sort_values(\nascending=False\n).reset_index().merge(\naisle, on="aisle_id", how="left"\n).merge(\ndepartment, on="department_id", how="left"\n).sort_values(\n["aisle_id", "department_id"]\n).head(25)  \n```' metadata={'Header 1': 'Count number of items with a particular aisle/department'}page_content='This file contains meta information about each of the 3 million orders that are covered in the dataset.  \n* `order_id`: A unique identifier for each order made\n* `user_id`: A unique identifier for each consumer that made one of the 3 million orders\n* `eval_set`: Instacart released this data for machine learning and classified orders into `prior`, `train`, and `test`\n* `order_number`: The order in which the individual made the given orders\n* `order_dow`: An integer between 0 and 6 denoting the day of the week the order was made\n* `order_hour_of_day`: An integer between 0 and 23 denoting the hour of the day that the order was made\n* `days_since_prior_order`: An integer that represents how many days it has been since a customers previous order  \n**What is not included?**  \nInstacart does not disclose the exact date of the transactions or the geography in which the transaction took place.  \n```python\norders = pd.read_csv("https://compsosci-resources.s3.amazonaws.com/instacart/orders.csv")\norders.to_parquet("orders.parquet")\n```  \n```python\norders.describe()\n```  \n```python\norders.head()\n```' metadata={'Header 1': 'Count number of items with a particular aisle/department', 'Header 3': 'Orders: `orders.csv`'}page_content='This file contains detailed information about each of the orders:  \n* `order_id`: A unique identifier that describes which order the purchase belonged to\n* `product_id`: An identifier for the product that was purchased\n* `add_to_cart_order`: The order in which the items were placed in the cart\n* `reordered`: Was the item reordered  \n**What is not included?**  \nInstacart does not disclose two pieces of information that would typically be important:  \n1. Price paid for a product\n2. Quantity purchased  \n```python\nprior_orders = pd.read_csv("https://compsosci-resources.s3.amazonaws.com/instacart/order_products__prior.csv")  \nprior_orders.describe()\n```  \n```python\ntrain_orders = pd.read_csv("https://compsosci-resources.s3.amazonaws.com/instacart/order_products__train.csv")  \ntrain_orders.describe()\n```  \n```python\norder_products = pd.concat([prior_orders, train_orders], axis=0, ignore_index=True)\norder_products.to_parquet("order_products_all.parquet")  \n```' metadata={'Header 1': 'Count number of items with a particular aisle/department', 'Header 3': 'Order Products: `order_products__prior.csv` and `order_products__train.csv`'}page_content="These files are organized in a way that each one contains information that either references or is referenced by one of the other files.  \n* `aisles.csv` and `departments.csv` are used to provide additional information and context for `products.csv`.\n* `products.csv` describes the products that appear in `order_products__prior.csv` and `order_products__train.csv`.\n* `orders.csv` contains information about when and who made the orders that show up in `order_products__prior.csv` and `order_products__train.csv`.  \nLet's explicitly write down these relationships to set the stage for the coming lecture about SQL." metadata={'Header 1': 'Count number of items with a particular aisle/department', 'Header 2': 'Relational nature of the files'}page_content='Instacart was particularly interested in determining whether certain items (or groups of items) were reordered more than others.  \nLet\'s explore what items/groups were the most reordered -- We will do this by computing the fraction of "reorders" for a particular item/group ($j$) by computing:  \n$$\\gamma_j = \\frac{\\sum_i \\sum_{t_i} \\mathbb{1}_{\\text{reordered } j}}{\\sum_i \\sum_{t_i} \\mathbb{1}_{\\text{ordered } j}}$$  \n```python\norder_product_user = order_products.merge(\norders.loc[:, ["order_id", "user_id", "order_number", "days_since_prior_order"]],\nhow="left", on="order_id"\n)\n```  \n```python\norder_product_user.sort_values(["user_id", "order_number", "add_to_cart_order"])\n```  \n**Most reordered products**  \n```python\nmrp = order_product_user.loc[\n~order_product_user["days_since_prior_order"].isna(), :\n].groupby(\n"product_id"\n).agg(\n{"add_to_cart_order": "count", "reordered": "sum"}\n).query(\n"reordered > 10"\n).rename(\ncolumns={"add_to_cart_order": "norder", "reordered": "nreorder"}\n).assign(\nfrac_reorder=lambda x: x["nreorder"] / x["norder"]\n).sort_values(\n"frac_reorder", ascending=False\n).merge(products, on="product_id", how="left")\n```  \n```python\nmrp.describe()\n```  \n```python\nmrp.head()\n```  \n```python\norder_product_user.query("product_id == 43553").sort_values(["user_id", "order_number"])\n```  \n```python  \n```' metadata={'Header 1': 'Count number of items with a particular aisle/department', 'Header 2': 'Most frequently reordered?'}