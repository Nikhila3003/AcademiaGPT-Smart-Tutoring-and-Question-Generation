page_content='We will be using a version of the "Residential power usage 3years data - Timeseries" dataset from Kaggle (see https://www.kaggle.com/datasets/srinuti/residential-power-usage-3years-data-timeseries).  \nThis dataset includes two data files:  \n1. `power_usage_2016_to_2020.csv`: This includes the data on the number of kWh of energy used on each day from 2016 to 2020. The value column is measured in [kWh](https://en.wikipedia.org/wiki/Kilowatt-hour). The notes column can take values: `weekday`, `weekend`, `vacation`, `COVID_lockdown`.\n2. `weather_2016_2020_daily.csv`: This includes various pieces of weather information for each relevant day  \n```python\nimport pandas as pd\n```  \nLoad power usage data  \n```python\npower_usage = pd.read_csv("power_usage_2016_to_2020.csv")' metadata={'Header 1': 'Timeseries: In class exercise'}page_content='power_usage["dt"] = pd.date_range(\n"2016-06-01 00:00:00", freq="1H",\nperiods=power_usage.shape[0]\n)\npower_usage = (\npower_usage.drop(\ncolumns=["day_of_week", "StartDate"]\n)\n.rename(\ncolumns={"Value (kWh)": "value"}\n)\n)\n```  \n```python\npower_usage.tail()\n```  \nLoad weather data  \n```python\nweather = pd.read_csv("weather_2016_2020_daily.csv")  \nweather["date"] = pd.date_range(\n"2016-06-01", freq="1D", periods=weather.shape[0]\n)  \nweather = weather.drop(columns=["Date", "Day"])\n```  \n```python\nweather.head()\n```  \n```python\npower_usage = power_usage.set_index("dt")\n```  \n```python\nimport matplotlib.pyplot as plt\n```  \n```python' metadata={'Header 1': 'incorrectly so they need to be reset'}page_content='weather_subset = weather.loc[:, ["date", "Temp_max"]]\npower_subset = power_usage.drop(["notes"], axis=1).resample("d").sum()  \n```  \n```python\npower_subset.join(weather_subset.set_index("date")).plot()\n```  \n**Questions**  \nFeel free to explore the data on your own, but these are some hints for directions that we think could be interesting.  \nWhat week had the biggest difference between the largest and smallest hourly energy expenditure?  \n```python\n(\npower_usage\n.resample("W-Thu")\n["value"]\n.agg(["min", "max"])\n.rename(columns={"min": "minn", "max": "maxx"})\n.eval("maxx - minn")\n.idxmax()\n)\n```  \nPlot daily energy usage vs daily temperature  \n```python  \n```  \nWhat month had the highest total energy expenditure?  \n```python\npower_usage.drop(["notes"], axis=1).resample("m").sum().idxmax()\n```  \n```python\nweather.query("date == \'2016-08-31\'")\n```  \nWhat month had the highest average energy expenditure over all of the years?  \n```python\npower_usage.drop(["notes"], axis=1).resample("m").mean().idxmax()\n```  \nWhat months have the most rain where the data is collected?  \n```python\nweather.dtypes\n```  \n```python\nweather["moy"] = weather["date"].dt.month\n```  \n```python\nweather.groupby("moy")["Precipit"].mean()\n```  \nWhat months have the most wind?  \n```python  \n```  \nCompute the rolling 24 hour average of energy expenditure.  \nHow might you measure whether certain observations are an anomaly? According to your measure, are there anomalies? Do these anomalies correspond to something happening in the weather?  \n```python  \n```  \n```python  \n```  \n```python  \n```  \nCompute the rolling 7 day average of energy expenditure.  \nHow might you measure whether certain hourly observations are an anomaly? According to your measure, are there anomalies? Do these anomalies correspond to something happening in the weather?  \n```python\npower_df = power_usage.resample("d")["value"].sum()\n```  \n```python\npower_df.rolling(window="7d", min_periods=7).mean().plot()\n```  \n```python\npower_df.plot()\n```  \n```python\nimport numpy as np\n```  \n```python\nfoo = 100 * np.abs(power_df - power_df.rolling(window="7d", min_periods=7).mean()) / power_df.rolling(window="7d", min_periods=7).mean()\n```  \n```python\nfoo.describe()\n```  \n```python  \n```  \n```python\nfoo.loc["2016-07-15":"2016-07-24"]\n```  \n```python\npower_usage.resample("d").agg({"value": "sum", "notes": "first"}).loc["2016-07-15":"2016-07-22"]\n```  \n```python\npower_df.loc["2016-07-15":"2016-07-24"]\n```  \n```python\nweather.set_index("date").loc["2016-07-15":"2016-07-24"]\n```' metadata={'Header 1': 'fig, ax = plt.subplots()'}