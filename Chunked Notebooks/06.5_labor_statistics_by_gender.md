page_content='```python\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd  \n%matplotlib inline\n```' metadata={}page_content='```python\ndata = pd.read_parquet("bls_data.parquet")\nmetadata = pd.read_parquet("bls_metadata.parquet")  \n```  \n```python\nmetadata["cps_labor_force_status"].unique()\n```  \n```python\ndata["value"] = pd.to_numeric(data["value"])  \ndata["dt"] = pd.to_datetime(\ndata.apply(lambda x: f"1 {x[\'periodName\']} {x[\'year\']}", axis=1)\n)' metadata={'Header 2': 'Load data'}page_content='data = data.drop(\n["year", "periodName", "period"], axis=1\n).sort_values(\n["series_id", "dt"]\n)[["series_id", "dt", "value"]]  \nlfs_status = {\n"Employed": "employed",\n"Unemployed": "unemployed",\n"Not in labor force": "nilf",\n"Labor Force Flows Employed to Employed": "ee",\n"Labor Force Flows Employed to Unemployed": "eu",\n"Labor Force Flows Unemployed to Employed": "ue",\n"Labor Force Flows Unemployed to Unemployed": "uu",\n}  \nmetadata = metadata.replace({"cps_labor_force_status": lfs_status})  \nand_filters = [\n"(commerce_industry == \'All Industries\')",\n"(occupation == \'All Occupations\')",\n"(seasonality == \'Not Seasonally Adjusted\')",\n"(demographic_race == \'All Races\')",\n]  \nmetadata_lf = metadata.query(\n"&".join(and_filters)\n).loc[metadata["cps_labor_force_status"].isin(lfs_status.values()), :]  \ndf = pd.merge(\ndata, metadata_lf[["series_id", "cps_labor_force_status", "demographic_gender"]],\non="series_id", how="right"\n).rename(\ncolumns={"cps_labor_force_status": "variable"}\n)[["variable", "demographic_gender", "dt", "value"]]  \ndf = df.pivot_table(\nindex=["dt", "variable"], columns="demographic_gender", values="value"\n).rename(\ncolumns={"Both Sexes": "all", "Men": "men", "Women": "women"}\n).reset_index()  \n```' metadata={'Header 1': 'Drop unneeded date info'}page_content='```python\ndef filter_days_from(data, start_date, ndays=3*365):\n"""\nCreates a history of data starting at a particular date and running\nforward for `ndays` days.  \nParameters\n----------\ndata : pd.DataFrame\nA DataFrame with relevant data that we\'d like to consider\nstarting from a particular date. Must have a column `dt` with\ndatetime data\nstart_date : str or datetime\nThe moment we would like our history to start\nndays : int\nThe number of days that we would like to keep in our history  \nReturns\n-------\nout : pd.DataFrame\nA copy of `data` with only data from `start_date` to\n`start_date + f\'{ndays} days\'` and a new column that counts\nthe number of days since `start_date`\n"""' metadata={'Header 1': 'Drop unneeded date info', 'Header 2': 'Filter function from `v4_bls_exploration`'}page_content='days_from = (data["dt"] - pd.to_datetime(start_date)).dt.days' metadata={'Header 1': 'Determine number of days from certain date'}page_content='dates_to_keep = (days_from >= 0) & (days_from < ndays)' metadata={'Header 1': 'Check for >=0 days and <ndays'}page_content='out = data.copy()\nout["days_from"] = days_from\nout = out.loc[dates_to_keep, :]  \nreturn out.reset_index(drop=True)\n```' metadata={'Header 1': "Create copy of DataFrame that we'll use as the return"}page_content='```python\ndef clean_and_pivot_data(df):\nfoo = df.pivot(index="days_from", columns="variable", values="value")\nfoo["eu"] = foo.eval("eu / employed")\nfoo["ue"] = foo.eval("ue / unemployed")  \nreturn foo.loc[:, ["eu", "ue"]]  \ndef split_by_sex(df):\ndf_bs = clean_and_pivot_data(\ndf.loc[:, ["days_from", "dt", "variable", "all"]].rename(\ncolumns={"all": "value"}\n)\n)\ndf_m = clean_and_pivot_data(\ndf.loc[:, ["days_from", "dt", "variable", "men"]].rename(\ncolumns={"men": "value"}\n)\n)\ndf_w = clean_and_pivot_data(\ndf.loc[:, ["days_from", "dt", "variable", "women"]].rename(\ncolumns={"women": "value"}\n)\n)  \nreturn df_bs, df_m, df_w\n```  \n```python\ndf_covid = filter_days_from(\ndf, "2019-03-01", 5*365\n)  \ndf_covid_bs, df_covid_m, df_covid_w = split_by_sex(df_covid)  \ndf_gr = filter_days_from(\ndf, "2007-02-01", 5*365\n)  \ndf_gr_bs, df_gr_m, df_gr_w = split_by_sex(df_gr)\n```  \n```python\ndf_covid.query(\n"variable == \'employed\' | variable == \'unemployed\'"\n).loc[\n:, ["dt", "variable", "all"]\n].pivot_table(\nindex="dt", columns="variable", values="all"\n).sum(axis=1)\n```' metadata={'Header 1': "Create copy of DataFrame that we'll use as the return", 'Header 2': 'Put data in the right shape'}page_content='```python\nmcolor = "#138bb0"\nwcolor = "#c10ac4"  \n```  \n```python\nfig, ax = plt.subplots(2, 1, figsize=(10, 8), sharex=True)  \ndf_covid_bs.plot(\ny="eu", ax=ax[0],\ncolor="k", linestyle="--", linewidth=1.0, legend=False\n)\ndf_covid_m.plot(\ny="eu", ax=ax[0],\ncolor=mcolor, linestyle="-", linewidth=2.0, legend=False\n)\ndf_covid_w.plot(\ny="eu", ax=ax[0],\ncolor=wcolor, linestyle="-", linewidth=2.0, legend=False\n)  \ndf_covid_bs.plot(\ny="ue", ax=ax[1],\ncolor="k", linestyle="--", linewidth=1.0, legend=False\n)\ndf_covid_m.plot(\ny="ue", ax=ax[1],\ncolor=mcolor, linestyle="-", linewidth=2.0, legend=False\n)\ndf_covid_w.plot(\ny="ue", ax=ax[1],\ncolor=wcolor, linestyle="-", linewidth=2.0, legend=False\n)  \nax[0].set_title("EU Transition Rate")\nax[1].set_title("UE Transition Rate")\nax[1].set_xlabel("Days since one year before trough")\nax[1].set_ylabel("People in thousands")  \nfor _ax in ax:\n_ax.spines["right"].set_visible(False)\n_ax.spines["top"].set_visible(False)\n_ax.set_facecolor((0.975, 0.975, 0.975))  \nfig.set_facecolor((0.975, 0.975, 0.975))  \nax[0].annotate("Men", (410, 0.02), color=mcolor, size=12)\nax[0].annotate("Women", (410, 0.12), color=wcolor, size=12)  \nax[0].set_ylim(0.0, 0.15)\nax[1].set_ylim(0.0, 0.5)  \nfig.tight_layout()\n```  \n```python\nfig, ax = plt.subplots(2, 1, figsize=(10, 8), sharex=True)  \ndf_gr_bs.plot(\ny="eu", ax=ax[0],\ncolor="k", linestyle="--", linewidth=1.0, legend=False\n)\ndf_gr_m.plot(\ny="eu", ax=ax[0],\ncolor=mcolor, linestyle="-", linewidth=2.0, legend=False\n)\ndf_gr_w.plot(\ny="eu", ax=ax[0],\ncolor=wcolor, linestyle="-", linewidth=2.0, legend=False\n)  \ndf_gr_bs.plot(\ny="ue", ax=ax[1],\ncolor="k", linestyle="--", linewidth=1.0, legend=False\n)\ndf_gr_m.plot(\ny="ue", ax=ax[1],\ncolor=mcolor, linestyle="-", linewidth=2.0, legend=False\n)\ndf_gr_w.plot(\ny="ue", ax=ax[1],\ncolor=wcolor, linestyle="-", linewidth=2.0, legend=False\n)  \nax[0].set_title("EU Transition Rate")\nax[1].set_title("UE Transition Rate")\nax[1].set_xlabel("Days since one year before trough")\nax[1].set_ylabel("People in thousands")  \nfor _ax in ax:\n_ax.spines["right"].set_visible(False)\n_ax.spines["top"].set_visible(False)\n_ax.set_facecolor((0.975, 0.975, 0.975))  \nfig.set_facecolor((0.975, 0.975, 0.975))  \nax[0].annotate("Men", (1000, 0.04), color=mcolor, size=12)\nax[0].annotate("Women", (225, 0.03), color=wcolor, size=12)  \nax[0].set_ylim(0.0, 0.15)\nax[1].set_ylim(0.0, 0.5)  \nfig.tight_layout()\n```' metadata={'Header 1': "Create copy of DataFrame that we'll use as the return", 'Header 2': 'Make plots'}page_content='```python\ndf_covid.query(\n"variable == \'employed\'"\n).reset_index(\ndrop=True\n).set_index(\n"days_from"\n).loc[\n:, ["all", "men", "women"]\n].diff().cumsum().plot()\n```' metadata={'Header 1': "Create copy of DataFrame that we'll use as the return", 'Header 2': 'More graphs'}